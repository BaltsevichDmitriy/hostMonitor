name: Host Monitor
on:
  schedule:
    - cron: '*/30 * * * *'  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
  workflow_dispatch:        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Check host
        id: check
        run: |
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ö–æ—Å—Ç–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 10 —Å–µ–∫—É–Ω–¥
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 10 http://chapay.duckdns.org:8123/ || echo "000")
          if [ "$STATUS" -eq 200 ]; then
            echo "result=UP" >> $GITHUB_OUTPUT
            echo "status_code=$STATUS" >> $GITHUB_OUTPUT
          else
            echo "result=DOWN" >> $GITHUB_OUTPUT
            echo "status_code=$STATUS" >> $GITHUB_OUTPUT
          fi

      - name: Send Telegram alert
        if: steps.check.outputs.result == 'DOWN'
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.CHAT_ID }}" \
          -d "text=üö® –í–ù–ò–ú–ê–ù–ò–ï! –•–æ—Å—Ç http://chapay.duckdns.org:8123/ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!%0A–ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞: ${{ steps.check.outputs.status_code }}%0A–í—Ä–µ–º—è: $(date '+%Y-%m-%d %H:%M:%S')" \
          -d "disable_web_page_preview=true"
